[
["A04-murders.html", "C Murder Accountability Project exercises C.1 The data C.2 Exercises by chapter C.3 Answers to exercises", " C Murder Accountability Project exercises table { font-size:.8em; } The Murder Accountability Project was profiled in the New Yorker in November, 2017. Andrew B Tran brilliantly decided to use its data as a vehicle for learning R in his R for Journalists’ online class. This set of tutorials adapts his exercises for people using this textbook. You should consider taking his entire free full course if you want to get more detail. Download the data into a new or existing R project, then load it using the load(file=\"murder_data.Rda\") command in a code chunk. C.1 The data This R dataset was created by subsetting only mountain states and Oregon and Washington from the national dataset, and converting the codes used in the original SPSS data into codes and their labels in separate variables. The data runs from 1976 through 2018. Here are the fields included: ## Observations: 56,075 ## Variables: 37 ## $ rowid &lt;int&gt; 27475, 27476, 27477, 27478, 27479, 27480, 27481, 27482, 27483, 27484, 27485, 27486, 27487… ## $ mapid &lt;chr&gt; &quot;197612001AZ00100&quot;, &quot;197708001AZ00100&quot;, &quot;197801001AZ00100&quot;, &quot;198207001AZ00100&quot;, &quot;19850600… ## $ year &lt;dbl&gt; 1976, 1977, 1978, 1982, 1985, 1988, 1989, 1990, 1990, 1991, 1992, 1995, 1995, 1996, 2003,… ## $ month &lt;dbl&gt; 12, 8, 1, 7, 6, 11, 10, 9, 12, 2, 12, 3, 9, 4, 2, 8, 9, 8, 9, 7, 7, 5, 3, 8, 7, 10, 6, 9,… ## $ fip &lt;chr&gt; &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;, &quot;04001&quot;,… ## $ state_fip &lt;chr&gt; &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;, &quot;04&quot;,… ## $ cnty_name &lt;chr&gt; &quot;Apache, AZ&quot;, &quot;Apache, AZ&quot;, &quot;Apache, AZ&quot;, &quot;Apache, AZ&quot;, &quot;Apache, AZ&quot;, &quot;Apache, AZ&quot;, &quot;Apac… ## $ msa_code &lt;chr&gt; &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;, &quot;99904&quot;,… ## $ msa_name &lt;chr&gt; &quot;Rural Arizona&quot;, &quot;Rural Arizona&quot;, &quot;Rural Arizona&quot;, &quot;Rural Arizona&quot;, &quot;Rural Arizona&quot;, &quot;Rur… ## $ state_abbr &lt;chr&gt; &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;, &quot;AZ&quot;,… ## $ ori &lt;chr&gt; &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;AZ00100&quot;, &quot;… ## $ agency &lt;chr&gt; &quot;Apache County&quot;, &quot;Apache County&quot;, &quot;Apache County&quot;, &quot;Apache County&quot;, &quot;Apache County&quot;, &quot;Apa… ## $ agency_type &lt;chr&gt; &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;Sheriff&quot;, &quot;… ## $ solved &lt;chr&gt; &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;No&quot;, &quot;No&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;No&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;… ## $ homicide_type &lt;chr&gt; &quot;Murder and non-negligent manslaughter&quot;, &quot;Murder and non-negligent manslaughter&quot;, &quot;Mansla… ## $ incident_num &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,… ## $ vic_age &lt;dbl&gt; 42, 28, 0, 23, 18, 23, 43, 33, 33, 0, 38, 0, 37, 25, 60, 17, 60, 24, 35, 80, 74, 13, 3, 5… ## $ vic_sex &lt;chr&gt; &quot;Male&quot;, &quot;Male&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Female&quot;, &quot;Ma… ## $ vic_race_code &lt;chr&gt; &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;,… ## $ vic_race &lt;chr&gt; &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;,… ## $ vic_ethnic_code &lt;chr&gt; &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;N&quot;, &quot;U&quot;, &quot;U&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;H&quot;, &quot;N&quot;, &quot;N&quot;,… ## $ vic_ethnic &lt;chr&gt; &quot;Unknown or not reported&quot;, &quot;Unknown or not reported&quot;, &quot;Unknown or not reported&quot;, &quot;Not of … ## $ off_age &lt;dbl&gt; 22, 44, 50, 999, 999, 41, 39, 48, 999, 29, 18, 14, 23, 63, 45, 21, 21, 23, 29, 51, 51, 12… ## $ off_sex &lt;chr&gt; &quot;Male&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Unknown&quot;, &quot;Unknown&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Unknown&quot;, &quot;Male&quot;, … ## $ off_race_code &lt;chr&gt; &quot;I&quot;, &quot;W&quot;, &quot;W&quot;, &quot;U&quot;, &quot;U&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;U&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;, &quot;W&quot;,… ## $ off_race &lt;chr&gt; &quot;American Indian or Alaskan Native&quot;, &quot;White&quot;, &quot;White&quot;, &quot;Unknown&quot;, &quot;Unknown&quot;, &quot;White&quot;, &quot;Wh… ## $ off_ethnic_code &lt;chr&gt; &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;N&quot;, &quot;N&quot;, &quot;U&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;,… ## $ off_ethnic &lt;chr&gt; &quot;Unknown or not reported&quot;, &quot;Unknown or not reported&quot;, &quot;Unknown or not reported&quot;, &quot;Unknown… ## $ situation_code &lt;chr&gt; &quot;C&quot;, &quot;A&quot;, &quot;C&quot;, &quot;B&quot;, &quot;B&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;B&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;,… ## $ situation &lt;chr&gt; &quot;Single victim/multiple offenders&quot;, &quot;Single victim/single offender&quot;, &quot;Single victim/multi… ## $ weapon_code &lt;chr&gt; &quot;20&quot;, &quot;13&quot;, &quot;90&quot;, &quot;11&quot;, &quot;12&quot;, &quot;12&quot;, &quot;12&quot;, &quot;12&quot;, &quot;12&quot;, &quot;40&quot;, &quot;12&quot;, &quot;40&quot;, &quot;14&quot;, &quot;12&quot;, &quot;14&quot;,… ## $ weapon &lt;chr&gt; &quot;Knife or cutting instrument&quot;, &quot;Rifle&quot;, &quot;Other or type unknown&quot;, &quot;Firearm, type not state… ## $ relationship_code &lt;chr&gt; &quot;AQ&quot;, &quot;AQ&quot;, &quot;DA&quot;, &quot;UN&quot;, &quot;UN&quot;, &quot;AQ&quot;, &quot;AQ&quot;, &quot;AQ&quot;, &quot;ST&quot;, &quot;DA&quot;, &quot;AQ&quot;, &quot;SO&quot;, &quot;OK&quot;, &quot;AQ&quot;, &quot;AQ&quot;,… ## $ relationship &lt;chr&gt; &quot;Acquaintance&quot;, &quot;Acquaintance&quot;, &quot;Daughter&quot;, &quot;Relationship not determined&quot;, &quot;Relationship … ## $ circumstance_code &lt;chr&gt; &quot;42&quot;, &quot;44&quot;, &quot;59&quot;, &quot;99&quot;, &quot;99&quot;, &quot;45&quot;, &quot;5&quot;, &quot;60&quot;, &quot;3&quot;, &quot;59&quot;, &quot;60&quot;, &quot;60&quot;, &quot;45&quot;, &quot;40&quot;, &quot;60&quot;, &quot;… ## $ circumstance &lt;chr&gt; &quot;Brawl due to influence of alcohol&quot;, &quot;Argument over money or property&quot;, &quot;All other mansla… ## $ use_date &lt;date&gt; 1980-03-01, 1980-03-01, 1980-03-01, 1982-10-06, 1985-08-21, 1989-03-15, 1990-02-06, 1991… Any variable that begins with off refers to the offender; any variable that begins with vic refers to the victim. Most variables are pretty self-explanatory, but here are a few details: fip and state_fip are standard codes used across many databases to identify geographic areas – in this case, counties and states. msa_code and msa_name refer to Metropolitan Statistical Areas, which combine nearby counties regardless of state into areas that are often considered on large metropolitan area, such as Washington DC and the Virginia and Maryland suburbs. ori, agency and agency_type refer to the law enforcement agency – police or sheriff’s office – that investigated the murder. An ORI is a standard code for each agency from the FBI. relationship_code and relationship can be confusing. They refer to the relationship of the victim to the offender, not the other way around. For example, “Wife” means that the victim was the killer’s wife, not that the killer was the victim’s wife. This is unclear in the FBI documentation. More details are available in this detailed record layout and data dictionary. C.2 Exercises by chapter C.2.1 Select and filter exercises Here are some suggested exercises to practice what you learned in Chapter 5, Select and Filter: Older wives as victims in Arizona Create a new data frame called arizona_murders based on just the murders that were reported in that state. Try doing these one step at a time by adding to a query : Pick out just following variables to work with: year name of the county and the police department, whether it was solved, demographics (eg, age, race, sex, ethnicity) of the victim and the offender, information on the weapon and the relationship List all of the murders in which the killer was the husband of the victim. This can be done using either the relationship or the relationship_code. Add a condition that the wives were at least 60 years old. Sort the answer by oldest to youngest Gun-related killings Finding out what codes are in the data could be done with a group_by/summarise query, but there is another verb that can show you every unique value in a dataset. Use this code to show you every type of weapon used in the dataset: murder_data %&gt;% distinct (weapon_code, weapon) %&gt;% arrange (weapon_code) The verb distinct is used instead of select to just show a list of values that are never repeated. When you run that code, you can see why it’s sometimes useful to keep codes as well as words in a dataset – codes “11” through “15” refer to some kind of gun. **Q: Find all gun-related murders of young black or Hispanic men since 2015. You can define “young” however you want, but in my example I’ll use victims between 15 and 29. In this example, you’ll have to combine OR conditions, with others. Remember you can use BETWEEN for ranges of values or %in% for a list of values. Advanced exercises using other conditions If you’re feeling adventurous, try figuring out how you might find: Any domestic-violence related incidents. Hint: This would be an %in% condition once you look at your options using either “distinct” or a group-by query. Try using str_detect when you want to use wild cards instead of exact matches. These take regular expressions as arguments. So to find any gun in this dataset, you’d use str_detect(weapon_code, &quot;^1&quot;) (For more details on regular expressions, try the Regex101 tutorial on our class website. Using regular expressions is often a way to make queries shorter and less fussy, but they are not as clear to a reader – they often take some puzzling through.) C.2.2 Group by and summarise The group by exercises are just like a pivot table. In fact, to turn it on its head, you use the command “pivot_wider” “The most” Which county in this small dataset has the most murders? Which one has the most police killings? (Look in the circumstance column for this.) Create a table showing the number of murders by year and state (with states across the top, and years down the side). This is a group_by / summarise / arrange / pivot_wider exercise Try calculating the percent of murders by relationship. For this to work, you can only keep one group_by column (relationship) Putting it all together What percent of each state’s domestic violence victims are of Hispanic origin? Bonus: Mutate with group_by Chapter 7, Mutate, has an example of creating a new category out of an old one. Try to puzzle through how to find the county that has the highest rate of gun murders vs. other weapons. This involves three steps: creating a new category of Yes/No out of the weapon; grouping and counting; then rolling up to the next level. C.3 Answers to exercises C.3.1 Select and filter Arizona wives Create a new dataset with just arizona: arizona_murders &lt;- murder_data %&gt;% filter ( state_abbr == &quot;AZ&quot;) You should have 15,443 rows in this dataset. The final set of queries might look like this. (You might have noticed you that you had one victim age 999 when you sorted. That means “unknown” in this dataset, so you’ll want to filter that out as well.) arizona_murders %&gt;% select ( year, cnty_name, agency, solved, starts_with(&quot;vic&quot;), starts_with(&quot;off&quot;), contains (&quot;relationship&quot;)) %&gt;% filter (relationship == &quot;Wife&quot; &amp; vic_age &gt;= 60 &amp; vic_age &lt; 999 ) %&gt;% arrange ( desc(vic_age)) You could also use relationship == &quot;Wife&quot; &amp; between (vic_age, 60, 998) You might also notice that there is a Male “wife” as a victim, reflecting how poorly many police agencies fill out these forms. Gun-related killings This is actually much more difficult than it sounds. Try to build it one piece at a time. Here is how I might build the conditions: Guns: ... weapon_code %in% c(&quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;) (This is a text variable even though it looks like numbers - that means you need the quotes. Don’t forget to use the “c” for “combine into a list” before the list of values)2 Since 2015: weapon_code %in% c(&quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;) &amp; year &gt;= 2015 Young men: weapon_code %in% c(&quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;) &amp; year &gt;= 2015 &amp; between (vic_age, 15, 29) Black and Hispanic victims: weapon_code %in% c(&quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;) &amp; year &gt;= 2015 &amp; between (vic_age, 15, 29) &amp; (vic_race_code == &quot;B&quot; | vic_ethnic_code = &quot;H&quot;) That last one is the trickiest – If you want to find both African-American AND Hispanic victims, you need to look for a race code of “B” OR an ethnicity code of “H”. Those have to be in a parenthese in order not to be confused with the other conditions. (I’m going to select just some of the columns and order it by the year and month of the murder, showing only the most recent). (NOTE: Eliminate the last line of this code if you haven’t installed and activated the “DT” package, which makes searchable, sortable tables.) murder_data %&gt;% filter ( weapon_code %in% c(&quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;) &amp; year &gt;= 2015 &amp; between (vic_age, 15, 29) &amp; (vic_race_code == &quot;B&quot; | vic_ethnic_code == &quot;H&quot;) ) %&gt;% select (year, month, cnty_name, state_abbr, solved, vic_age, vic_race, vic_ethnic, weapon, relationship, circumstance ) %&gt;% arrange (year, month) %&gt;% tail (50) %&gt;% datatable( options = list(scrollX = &#39;500px&#39;)) If this complex filter seems too complex, you can always chain one filter after another to check your data as you go. For example, you could do this: murder_data %&gt;% filter ( weapon_code %in% c(&quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;) ) %&gt;% filter ( vic_race_code == &quot;B&quot; | vic_ethnic_code == &quot;H&quot;) .... C.3.2 Group by “The most” County with the most killings murder_data %&gt;% group_by (state_abbr, cnty_name) %&gt;% summarise ( cases = n() ) %&gt;% arrange (desc (cases)) Why is this answer not surprising? (Hint: Clark County, Nevada, has about half the population of Maricopa.) We’ll get to ways to normalize this in later chapters. To just get the police shootings, filter the above query for circumstance_code == \"81\" before the group_by Murders by state and year (I’m putting the most recent year at the top) murder_data %&gt;% group_by (year, state_abbr) %&gt;% summarise (cases = n() ) %&gt;% #bonus: Calculate the total number of cases by year: mutate ( total_cases = sum(cases) ) %&gt;% pivot_wider (names_from = state_abbr, values_from = cases) %&gt;% arrange ( desc (year)) %&gt;% #Extra! fancy table that requires the DT package. datatable( options = list(scrollX= &quot;400px&quot;, pageLength = &quot;5&quot;, lengthMenu = c(5, 10, 50) ) ) Does this mean that these states have suddenly become more dangerous? What about population growth? Alternative method The janitor package (which you may need to install) has a way to create cross-tabulations like this more simply. The function is tabyl (to distinguish from other table operations in R, which you probably want to avoid). Here’s an example: murder_data %&gt;% tabyl ( year , state_abbr) %&gt;% arrange ( desc (year) ) %&gt;% head () %&gt;% #to make a nicer looking table, with the knitr() package kable() year AZ CO ID MT NM NV OR UT WA WY 2018 425 248 37 40 168 239 115 69 255 17 2017 484 252 48 43 166 311 131 82 242 14 2016 394 208 47 37 111 228 111 76 213 23 2015 344 189 32 38 105 203 85 61 224 18 2014 313 165 30 30 128 185 84 72 206 14 2013 383 186 30 16 119 168 85 51 194 17 Percent of murders by relationship: murder_data %&gt;% group_by (relationship) %&gt;% summarise (num_of_cases = n() ) %&gt;% mutate (total_cases = sum(num_of_cases) , # This rounds to 1 digit. pct_cases = round (num_of_cases / total_cases * 100 , 1) ) %&gt;% # you could un-select the total cases since they&#39;ll always be the same , but for illustratio purposes I&#39;m keeping it. arrange ( desc (num_of_cases)) Alternative method with janitor::tabyl murder_data %&gt;% tabyl (relationship) %&gt;% adorn_pct_formatting (digits=1) %&gt;% #this last part turns it into a normal data frame arrange ( desc(n)) %&gt;% as_tibble() Why is this answer not surprising? (Hint: Clark County, Nevada, has about half the population of Maricopa.) We’ll get to ways to normalize this in later chapters. To just get the police shootings, filter the above query for circumstance_code == \"81\" before the group_by Murders by state and year (I’m putting the most recent year at the top) murder_data %&gt;% group_by (year, state_abbr) %&gt;% summarise (cases = n() ) %&gt;% #bonus: Calculate the total number of cases by year: mutate ( total_cases = sum(cases) ) %&gt;% pivot_wider (names_from = state_abbr, values_from = cases) %&gt;% arrange ( desc (year)) %&gt;% #Extra! fancy table that requires the DT package. datatable( options = list(scrollX= &quot;400px&quot;, pageLength = &quot;5&quot;, lengthMenu = c(5, 10, 50) ) ) Does this mean that these states have suddenly become more dangerous? What about population growth? NOTE: Later on, we’ll get to other packages, which includes janitor – a useful way to clean data. That package has a much easier way to produce tables while formatting them well. If you’ve already installed and loaded the package, here’s another way to do the same thing: murder_data %&gt;% tabyl ( year , state_abbr) %&gt;% arrange ( desc (year) ) %&gt;% head () %&gt;% kable() year AZ CO ID MT NM NV OR UT WA WY 2018 425 248 37 40 168 239 115 69 255 17 2017 484 252 48 43 166 311 131 82 242 14 2016 394 208 47 37 111 228 111 76 213 23 2015 344 189 32 38 105 203 85 61 224 18 2014 313 165 30 30 128 185 84 72 206 14 2013 383 186 30 16 119 168 85 51 194 17 Percent of murders by relationship: murder_data %&gt;% group_by (relationship) %&gt;% summarise (num_of_cases = n() ) %&gt;% mutate (total_cases = sum(num_of_cases) , # This rounds to 1 digit. pct_cases = round (num_of_cases / total_cases * 100 , 1) ) %&gt;% # you could un-select the total cases since they&#39;ll always be the same , but for illustratio purposes I&#39;m keeping it. arrange ( desc (num_of_cases)) Again, using the tabyl function from the janitor package: murder_data %&gt;% tabyl (relationship) %&gt;% adorn_pct_formatting (digits=1) %&gt;% kable() relationship n percent Acquaintance 11935 21.3% Boyfriend 669 1.2% Brother 534 1.0% Common-law husband 84 0.1% Common-law wife 178 0.3% Daughter 1005 1.8% Employee 53 0.1% Employer 74 0.1% Ex-husband 76 0.1% Ex-wife 287 0.5% Father 480 0.9% Friend 2368 4.2% Girlfriend 1893 3.4% Homosexual relationship 135 0.2% Husband 904 1.6% In-law 365 0.7% Mother 559 1.0% Neighbor 727 1.3% Other - known to victim 2349 4.2% Other family 873 1.6% Relationship not determined 15774 28.1% Sister 168 0.3% Son 1260 2.2% Stepdaughter 102 0.2% Stepfather 159 0.3% Stepmother 23 0.0% Stepson 163 0.3% Stranger 9988 17.8% Wife 2890 5.2% Putting it all together First, isolate the domestic violence cases. Let’s see what our choices are: murder_data %&gt;% group_by (relationship_code, relationship) %&gt;% summarise (n()) Here’s one way to get the answer (eliminating cases in which we don’t know the victim’s ethnicity) murder_data %&gt;% filter ( relationship_code %in% c(&quot;BF&quot;, &quot;BR&quot;, &quot;CH&quot;, &quot;CW&quot;, &quot;DA&quot;, &quot;FA&quot;, &quot;GF&quot;, &quot;HO&quot;, &quot;HU&quot;, &quot;IL&quot;, &quot;MO&quot;, &quot;OF&quot;, &quot;SD&quot;, &quot;SF&quot;, &quot;SI&quot;, &quot;SM&quot;, &quot;SO&quot;, &quot;WI&quot;, &quot;XH&quot;, &quot;XW&quot;) &amp; vic_ethnic_code %in% c(&quot;H&quot;, &quot;N&quot;) ) %&gt;% group_by ( state_abbr, vic_ethnic ) %&gt;% summarise (cases = n() ) %&gt;% #calculate total by state and percent mutate ( total_cases = sum(cases), pct_cases = cases / total_cases * 100 ) %&gt;% #get rid of case counts select ( -cases ) %&gt;% #sort by state arrange ( state_abbr ) %&gt;% # put ethnicity in columns pivot_wider ( values_from = pct_cases, names_from = vic_ethnic) Alternative Using the janitor::tabyl function murder_data %&gt;% filter ( relationship_code %in% c(&quot;BF&quot;, &quot;BR&quot;, &quot;CH&quot;, &quot;CW&quot;, &quot;DA&quot;, &quot;FA&quot;, &quot;GF&quot;, &quot;HO&quot;, &quot;HU&quot;, &quot;IL&quot;, &quot;MO&quot;, &quot;OF&quot;, &quot;SD&quot;, &quot;SF&quot;, &quot;SI&quot;, &quot;SM&quot;, &quot;SO&quot;, &quot;WI&quot;, &quot;XH&quot;, &quot;XW&quot;) &amp; vic_ethnic_code %in% c(&quot;H&quot;, &quot;N&quot;) ) %&gt;% tabyl ( state_abbr, vic_ethnic) %&gt;% # include column and row totals adorn_totals ( c(&quot;row&quot;, &quot;col&quot;)) %&gt;% #calculate % of row total (within state) adorn_percentages ( &quot;row&quot;) %&gt;% # remove decimal places adorn_pct_formatting (digits=1) %&gt;% # include # of cases adorn_ns %&gt;% # turn it into a regular data frame as_tibble() If you wanted to go further with filtering, you might look at the regular expressions available for more sophisticated filtering using the str_detect function. In this case, str_detect (weapon_code, \"^1\") searches for anything in the field that begins with a “1”.↩ "]
]
